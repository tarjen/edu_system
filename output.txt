./home/shuacm/Desktop/edu_system/online_judge/models/contests.py:161: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
  problem = Problem.query.get(problem_id)
EEEEFEEEE.EE
======================================================================
ERROR: test_contest_problem_operations (__main__.ContestAPITestCase)
测试题目管理接口 /api/contest/<id>/problems
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 172, in test_contest_problem_operations
    resp = self.client.post('/api/contest/1/problems',
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1167, in post
    return self.open(*args, **kw)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/testing.py", line 234, in open
    response = super().open(
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1116, in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 988, in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1264, in run_wsgi_app
    app_rv = app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1536, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1514, in wsgi_app
    response = self.handle_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/home/shuacm/Desktop/edu_system/online_judge/api/contest/update.py", line 145, in update_contest_problems
    "problem_ids": contest.get_problem_ids()
AttributeError: 'Contest' object has no attribute 'get_problem_ids'

======================================================================
ERROR: test_contest_submission_permission (__main__.ContestAPITestCase)
测试非参赛用户访问提交记录的权限
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 285, in test_contest_submission_permission
    resp = self.client.get('/api/contest/get_all_submission/1', headers=self.get_headers(2))
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 129, in get_headers
    return {'token': self.tokens[token_key]}
KeyError: 2

======================================================================
ERROR: test_create_contest (__main__.ContestAPITestCase)
测试创建比赛接口 /api/contests
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 198, in test_create_contest
    resp = self.client.post('/api/contests',
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1167, in post
    return self.open(*args, **kw)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/testing.py", line 234, in open
    response = super().open(
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1116, in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 988, in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1264, in run_wsgi_app
    app_rv = app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1536, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1514, in wsgi_app
    response = self.handle_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/home/shuacm/Desktop/edu_system/online_judge/api/contest/update.py", line 202, in create_contest
    new_contest = Contest(
TypeError: __init__() got an unexpected keyword argument 'information'

======================================================================
ERROR: test_filter_contests (__main__.ContestAPITestCase)
测试比赛过滤接口 /api/contest/filter
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 136, in test_filter_contests
    resp = self.client.post('/api/contest/filter', json={'title': 'Admin'})
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1167, in post
    return self.open(*args, **kw)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/testing.py", line 234, in open
    response = super().open(
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1116, in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 988, in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1264, in run_wsgi_app
    app_rv = app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1536, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1514, in wsgi_app
    response = self.handle_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 920, in full_dispatch_request
    return self.finalize_request(rv)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 939, in finalize_request
    response = self.make_response(rv)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1204, in make_response
    raise TypeError(
TypeError: The view function did not return a valid response tuple. The tuple must have the form (body, status, headers), (body, status), or (body, headers).

======================================================================
ERROR: test_get_contest_info (__main__.ContestAPITestCase)
测试获取比赛信息接口 /api/contest/getinfo
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 150, in test_get_contest_info
    resp = self.client.get('/api/contest/getinfo/2',
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1162, in get
    return self.open(*args, **kw)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/testing.py", line 234, in open
    response = super().open(
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1116, in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 988, in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1264, in run_wsgi_app
    app_rv = app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1536, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1514, in wsgi_app
    response = self.handle_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/home/shuacm/Desktop/edu_system/online_judge/api/contest/show.py", line 70, in get_contestinfo
    if not contest.is_allowed_view(user):
  File "/home/shuacm/Desktop/edu_system/online_judge/models/contests.py", line 292, in is_allowed_view
    return self.is_allowed_edit(user) or contestuser is not None
  File "/home/shuacm/Desktop/edu_system/online_judge/models/contests.py", line 286, in is_allowed_edit
    if user and user.id == self.holder.id:
AttributeError: 'Contest' object has no attribute 'holder'

======================================================================
ERROR: test_solved_problems (__main__.ContestAPITestCase)
测试获取已解决题目接口 /api/contest/get_contest_user_solved_problem
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 218, in test_solved_problems
    cu = ContestUser(contest_id=1, user_id=2,
TypeError: __init__() got an unexpected keyword argument 'score_details'

======================================================================
ERROR: test_submission_status_update (__main__.ContestAPITestCase)
测试提交状态更新后的可见性
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 273, in test_submission_status_update
    sub.update_result_from_pending(status="RuntimeError",time_used = 1,memory_limit = 2)
TypeError: Submission.update_result_from_pending() got an unexpected keyword argument 'memory_limit'

======================================================================
ERROR: test_update_contest_info (__main__.ContestAPITestCase)
测试更新比赛信息接口 /api/contest/update_contest_info
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 209, in test_update_contest_info
    resp = self.client.post('/api/contest/update_contest_info/2',
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1167, in post
    return self.open(*args, **kw)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/testing.py", line 234, in open
    response = super().open(
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1116, in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 988, in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1264, in run_wsgi_app
    app_rv = app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1536, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1514, in wsgi_app
    response = self.handle_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/home/shuacm/Desktop/edu_system/online_judge/api/contest/update.py", line 32, in update_contest_info
    if not contest.is_allowed_edit(user):
  File "/home/shuacm/Desktop/edu_system/online_judge/models/contests.py", line 286, in is_allowed_edit
    if user and user.id == self.holder.id:
AttributeError: 'Contest' object has no attribute 'holder'

======================================================================
ERROR: test_user_submissions (__main__.ContestAPITestCase)
测试获取用户提交记录接口 /api/contest/get_contest_user_submission
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 181, in test_user_submissions
    sub = Submission(user_id=2, contest_id=1, problem_id=1)
TypeError: __init__() missing 3 required positional arguments: 'code', 'language', and 'submit_time'

======================================================================
ERROR: test_user_submissions_filter (__main__.ContestAPITestCase)
测试获取用户自己的提交记录
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 260, in test_user_submissions_filter
    resp = self.client.get('/api/contest/get_contest_user_submission/1', headers=headers)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1162, in get
    return self.open(*args, **kw)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/testing.py", line 234, in open
    response = super().open(
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1116, in open
    response_parts = self.run_wsgi_app(request.environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 988, in run_wsgi_app
    rv = run_wsgi_app(self.application, environ, buffered=buffered)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/werkzeug/test.py", line 1264, in run_wsgi_app
    app_rv = app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1536, in __call__
    return self.wsgi_app(environ, start_response)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1514, in wsgi_app
    response = self.handle_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 1511, in wsgi_app
    response = self.full_dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 919, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 917, in full_dispatch_request
    rv = self.dispatch_request()
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask/app.py", line 902, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/home/shuacm/Desktop/edu_system/virtual_env/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/home/shuacm/Desktop/edu_system/online_judge/api/contest/show.py", line 233, in get_contest_user_submission
    if not contest.is_allowed_view(user):
  File "/home/shuacm/Desktop/edu_system/online_judge/models/contests.py", line 292, in is_allowed_view
    return self.is_allowed_edit(user) or contestuser is not None
  File "/home/shuacm/Desktop/edu_system/online_judge/models/contests.py", line 286, in is_allowed_edit
    if user and user.id == self.holder.id:
AttributeError: 'Contest' object has no attribute 'holder'

======================================================================
FAIL: test_get_all_submissions (__main__.ContestAPITestCase)
测试获取比赛全部提交记录
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/shuacm/Desktop/edu_system/online_judge/test/test_contestAPI.py", line 249, in test_get_all_submissions
    self.assertEqual(len(resp.json), 2)
AssertionError: 0 != 2

----------------------------------------------------------------------
Ran 13 tests in 1.379s

FAILED (failures=1, errors=10)
